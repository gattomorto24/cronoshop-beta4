        

        // --- GESTIONE TEMA ---

        if (themeToggle) {

            themeToggle.addEventListener('change', () => {

                if (window.applyGlobalTheme) {

                    const newTheme = themeToggle.checked ? 'dark' : 'light';

                    window.applyGlobalTheme(newTheme);

                } else {

                     document.body.classList.toggle('light-mode', !themeToggle.checked);

                }

            });

        }

        if (document.body.classList.contains('light-mode')) {

             if (themeToggle) themeToggle.checked = false;

        }

        // --- GESTIONE PRODOTTI E MODALE ---

        const renderProducts = (filter = '') => {

            const query = filter.toLowerCase();

            const filteredProducts = products.filter(product => 
